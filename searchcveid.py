from mysql.connector import Error
from sqlconnec import connect
from tabulate import tabulate

def option_1():
    # user input
    cve_id = input("Enter CVE-ID (Ex: CVE-2024-1234): ")

    # connect to db
    conn = connect()
    cursor = conn.cursor()

    # query
    try:
        cursor.execute(f"SELECT * FROM CVE_ID WHERE ID = '{cve_id}'")
        result = cursor.fetchall()
        if result:
            print(tabulate(result, headers=cursor.column_names, tablefmt="psql"))
        else:
            print(f"CVE {cve_id} not found.")

    except Error as e:
        print("Error in searching CVE_ID:", e)

    finally:
        if conn.is_connected():
            cursor.close()
            conn.close()
            print("Connection closed.")

def return_to_menu():
    print("Returning to Menu...")
    return True


def display_menu():
    print("Choose your search option")
    print("1. Find CVE-ID")
    print("0. Exit")


def findcve_menu():
    menu_options = {
        "1": option_1,
        "0": return_to_menu,
    }

    while True:
        display_menu()
        choice = input("Enter your choice (1 or 0 to exit): ")

        if choice in menu_options:
            should_exit = menu_options[choice]()
            if should_exit:
                break
        else:
            print("Invalid choice. Please choose a number from 0 to 1.")
