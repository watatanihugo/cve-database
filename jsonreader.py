import os
import json
from sqlconnec import connect, insert_to_appliance, insert_to_cveid

def import_data():
    for root, dirs, files in os.walk("CVE Json/"):
        for name in files:
            if name.endswith((".json")):
                file_path = os.path.join(root, name)  # Get the current file path
                with open(file_path, "r", encoding="utf-8") as file:
                    json_data = file.read()

                # Parse JSON data
                data = json.loads(json_data)

                # Print specific fields
                print("File:", file_path)
                cve_id = data.get("cveMetadata", {}).get("cveId")
                name = (
                    data.get("containers", {})
                    .get("cna", {})
                    .get("affected", [{}])[0]
                    .get("vendor")
                )
                vendor = (
                    data.get("containers", {})
                    .get("cna", {})
                    .get("affected", [{}])[0]
                    .get("vendor")
                )
                medium = (
                    data.get("containers", {})
                    .get("cna", {})
                    .get("affected", [{}])[0]
                    .get("product")
                )
                version = (
                    data.get("containers", {})
                    .get("cna", {})
                    .get("affected", [{}])[0]
                    .get("versions", [{}])[0]
                    .get("version")
                )
                description = (
                    data.get("containers", {})
                    .get("cna", {})
                    .get("descriptions", [{}])[0]
                    .get("value")
                )
                references = (
                    data.get("containers", {}).get("cna", {}).get("references", [{}])
                )


                connect()
                insert_to_appliance(str(name), str(medium), str(os), str(version))
                insert_to_cveid(str(cve_id), str(name))
                #TODO: Implement sample data creator for other fields or modify .jsons

