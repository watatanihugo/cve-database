from mysql.connector import Error
from sqlconnec import connect
from tabulate import tabulate

def option_1():
    print("You chose Option 1")

    try:
        score = float(input("Enter the score you wish to find CVEs for 0-10: "))
    
        if score < 0 or score > 10:
            print("Invalid score. Please enter a score between 0 and 10.")
            return
    except ValueError:
        print("Invalid input. Please enter a valid number.")
        return
    
    # connect to db
    conn = connect()
    cursor = conn.cursor()
    # query
    try:
        cursor.execute(f"SELECT ID FROM CVE_Scores WHERE Base_Score = '%s'", (score,))
        result = cursor.fetchall()
        if result:
            print(tabulate(result, headers=cursor.column_names, tablefmt="psql"))
        else:
            print(f"CVE not found.")

    except Error as e:
        print("Error in searching CVE_Scores:", e)

    finally:
        if conn.is_connected():
            cursor.close()
            conn.close()
            print("Connection closed.")


def return_to_menu():
    print("Returning to Menu...")
    return True


def display_menu():
    print("Choose your search option")
    print("1. Find CVEs with certain score")
    print("0. Exit")


def searchscores_menu():
    menu_options = {
        "1": option_1,
        "0": return_to_menu,
    }

    while True:
        display_menu()
        choice = input("Enter your choice (1 or 0 to exit): ")

        if choice in menu_options:
            should_exit = menu_options[choice]()
            if should_exit:
                break
        else:
            print("Invalid choice. Please choose a number from 0 to 1.")
