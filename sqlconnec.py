import mysql.connector
from mysql.connector import Error

import os
from dotenv import load_dotenv

# Retrieve environment variables from .env file
load_dotenv()


def connect():
    """Connect to MySQL database"""
    try:
        conn = mysql.connector.connect(
            host=os.getenv("DB_HOST"),
            database=os.getenv("DB_DATABASE"),
            user=os.getenv("DB_USER"),
            password=os.getenv("DB_PASSWORD"),
        )
        if conn.is_connected():
            print("Connected to MySQL database")
            return conn

    except Error as e:
        # TODO: Better error handling
        print(e)


def insert_data(name, medium, os, version):
    """Insert data into the table"""
    conn = connect()
    cursor = conn.cursor()
    try:
        cursor.execute(
            "INSERT INTO vulnerable_appliances (Name, Medium, OS, Version) VALUES (%s, %s, %s, %s)",
            (name, medium, os, version),
        )
        conn.commit()
        print("Inserted one entry into vulnerable_appliances successfully!")
    except Error as e:
        # TODO: Better error handling
        print("Error:", e)
    finally:
        if conn.is_connected():
            cursor.close()
            conn.close()
            print("Connection closed.")


def main():
    name = "test"
    medium = "hardware"
    os = "linux"
    version = "12345"
    insert_data(name, medium, os, version)


if __name__ == "__main__":
    main()
