import mysql.connector
from mysql.connector import Error
from tabulate import tabulate
from sqlconnec import connect

def show_cves():
    "Show all cves"
    conn = connect()
    cursor = conn.cursor()
    try:
        cursor.execute("""
            SELECT c.ID, s.Base_Score, s.Attack_Vector_v3, LEFT(d.text_description, 90) AS truncated_description
            FROM CVE_ID c 
            JOIN CVE_Scores s ON c.ID = s.ID 
            JOIN Description d ON c.ID = d.ID
        """)
        result = cursor.fetchall()
        if result:
            headers = ["CVE_ID", "Base_Score", "Attack_Vector_v3", "Description"]
            print(tabulate(result, headers=headers, tablefmt="psql"))
        else:
            print("No CVEs found.")

    except Error as e:
        # TODO: Better error handling
        print("Error:", e)
    finally:
        if conn.is_connected():
            cursor.close()
            conn.close()
            print("Connection closed.")
